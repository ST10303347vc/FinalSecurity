# ./circleci/config.yml

version: 2.1

# 1. Orbs: Import the official SonarCloud orb
# This is a reusable package of CircleCI configuration.
orbs:
  sonarcloud: sonarsource/sonarcloud@3.0.1

# 2. Jobs: Define the tasks to run
jobs:
  build_and_scan:
    # Use a standard CircleCI image. We use a "Node" image
    # here as an example, but the 'sonarcloud/scan' step
    # works for any language.
    docker:
      - image: cimg/node:18.17
    
    steps:
      # Step 1: Get the code from GitHub
      - checkout

      # --- (Optional) Add your build & test steps here ---
      # Example for a Node.js project:
      # - run: npm install
      # - run: npm test
      # ----------------------------------------------------

      # Step 2: Run the SonarCloud scan
      # This single command does all the work.
      # It automatically uses the SONAR_TOKEN and SONAR_ORGANIZATION
      # variables you set in the CircleCI project settings.
      - sonarcloud/scan

# 3. Workflows: Orchestrate the jobs
workflows:
  main:
    jobs:
      - build_and_scan:
          # This 'context' is required by the orb to access
          # the SONAR_TOKEN environment variable securely.
          context:
            - sonarcloud.io
